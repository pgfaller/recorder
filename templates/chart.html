<meta charset="utf-8" />
<title>Indoor Temperature and Humidity</title>
<!-- import plugin script -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.22.2/moment.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.8.0/Chart.min.js"></script>
<h1>Temperature and Humidity</h1>
<div class="chart-container" style="position: relative; height:50vh; width:90vw">
  <canvas id="chart"></canvas>
</div>
<script>
  // bar chart data
  var cfg = {
    type: 'line',
    data: {
      datasets: [
        {
          label: 'Temperature',
          backgroundColor: "rgba(151,187,205,0.2)",
          borderColor: "rgba(151,187,205,1)",
          pointColor: "rgba(151,187,205,1)",
          pointStrokeColor: "#fff",
          pointHighlightFill: "#fff",
          pointHighlightStroke: "rgba(151,187,205,1)",
          bezierCurve : false,
          data: [
            {% for rec in recordings %}
            {% set timestamp, temperature, humidity = rec %}
            { t: new Date({{ timestamp * 1000 }}), y: {{ temperature }} },
            {% endfor %}
          ],
          yAxisID: 'temperature'
        },
        {
          label: 'Humidity',
          backgroundColor: "rgba(251,187,205,0.2)",
          borderColor: "rgba(251,187,205,1)",
          pointColor: "rgba(251,187,205,1)",
          pointStrokeColor: "#fff",
          pointHighlightFill: "#fff",
          pointHighlightStroke: "rgba(251,187,205,1)",
          bezierCurve : false,
          data: [
            {% for rec in recordings %}
            {% set timestamp, temperature, humidity = rec %}
            { t: new Date({{ timestamp * 1000 }}), y: {{ humidity }} },
            {% endfor %}
          ],
          yAxisID: 'humidity'
        }
      ]
    },
    options: {
      scales: {
        xAxes: [{
          type: 'time',
          distribution: 'linear',
          ticks: {
            source: 'data',
            autoSkip: true
          }
        }],
        yAxes: [
          {
            scaleLabel: {
              display: true,
              labelString: 'Temperature'
            },
  				  type: 'linear',
            display: true,
            position: 'left',
            id: 'temperature',
            ticks: {
              suggestedMin: 10,
              suggestedMax: 30
            }
          },
          {
            scaleLabel: {
              display: true,
              labelString: 'Humidity'
            },
            type: 'linear',
            display: true,
            position: 'right',
            id: 'humidity',
            ticks: {
              suggestedMin: 45,
              suggestedMax: 70
            },

            // grid line settings
            gridLines: {
              drawOnChartArea: false, // only want the grid lines for one axis to show up
            },
          }
        ]
      },
      tooltips: {
        intersect: false,
        mode: 'index',
        callbacks: {
          label: function(tooltipItem, myData) {
            var label = myData.datasets[tooltipItem.datasetIndex].label || '';
            if (label) {
              label += ': ';
            }
            label += parseFloat(tooltipItem.value).toFixed(2);
            return label;
          }
        }
      }
    }
  };
  // get bar chart canvas
  var mychart = document.getElementById("chart"); //.getContext("2d");
  var chart = new Chart(mychart, cfg);
</script>
